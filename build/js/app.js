"use strict";function googleError(){var e="<h3>Problem retrieving Map Data. Please reload the page to retry!</h3>";$("#map-error").html(e)}function getAreas(){return $.getJSON("https://api.myjson.com/bins/r7e1r").done(function(e){var t=e;$.each(t,function(e,t){myJson.push({id:t.id,name:t.name,loc:t.loc,info:t.info,coords:t.coords,fill:t.fill,img:t.img})}),ko.applyBindings(new AppViewModel(myJson)),initMap(myJson)}).fail(function(e){}),!1}function AppViewModel(e){this.searchTerm=ko.observable(),this.showRightHandList=ko.observable(!1),this.showResults=ko.observable(!0),this.submitted=ko.observable(!1),this.myAreas=ko.observableArray([{areaId:!1,areaName:"Choose an Area:",loc:!1}]),this.myPois=ko.observableArray([]),this.chosenArea=ko.observable(),this.fsqrFailText=ko.observable();var t=this;e.forEach(function(e){t.myAreas.push(new Area(e))}),this.setPois=function(e){t.myPois().length=0,e.forEach(function(e){t.myPois.push(new Poi(e))})},this.clearInfo=function(){this.showRightHandList(!1)},appView=t}var fsqrData=[],chosen,searchFor="",appView,myJson=[],fsqrElem=$("#fsqr-articles");fsqrElem.text("");var Area=function(e){this.areaId=ko.observable(e.id),this.areaId=e.id,this.areaName=e.name,this.loc=e.loc},Poi=function(e){this.poiId=e.id,this.poiName=e.name};this.submit=function(){if(appView.submitted(!0),appView.showRightHandList(!0),searchFor=appView.searchTerm(),chosen=appView.chosenArea(),fsqrData.length=0,fsqrElem.empty(),""===chosen.areaId||void 0===chosen.areaId||chosen.areaId===!1||""===searchFor||void 0===searchFor)return void appView.showRightHandList(!1);var e=chosen.loc.lat+","+chosen.loc.lng,t="https://api.foursquare.com/v2/venues/search?client_id=XV45PHON55RFFRM3GNN1BODO2NWH45LCGBKPVQWLOKGUI4XA&client_secret=YVKQJGWU1G2TH1BGQXHULAGHOYDL443Z3HPQ0JBFCJWM4QPD&v=20130815&ll="+e+"&query="+searchFor+"&intent=checkin&limit=5&radius=1000";return $.getJSON(t,function(e){var t=e.response.venues;$.each(t,function(e,t){t.categories[0]?fsqrData.push({id:e,name:t.name,lat:t.location.lat,lng:t.location.lng,address:t.location.formattedAddress,phone:t.contact.formattedPhone,url:t.url,iconPre:t.categories[0].icon.prefix,iconSuf:t.categories[0].icon.suffix}):t.categories[0]||fsqrData.push({id:e,name:t.name,lat:t.location.lat,lng:t.location.lng,address:t.location.formattedAddress,phone:t.contact.formattedPhone,url:t.url,iconPre:"https://ss3.4sqi.net/img/categories_v2/arts_entertainment/default_",iconSuf:".png"})}),$.each(fsqrData,function(e,t){void 0===t.url&&(t.url=" "),void 0===t.phone&&(t.phone=" ");for(var r=0;r<3;r++)void 0===t.address[r]&&(t.address[r]=" ")});var r=function(e){0===e.length?(fsqrElem.append('<span class="article">Sorry, no results found!</span>'),appView.showResults(!1)):appView.showResults(!0)};appView.setPois(fsqrData),r(fsqrData),initMap(fsqrData,appView)}).fail(function(e){appView.fsqrFailText("Foursquare results could not be loaded")}),!1};var centerOn={lat:52.539722,lng:13.431667},map,myMarker,myMarkers=[],markerFsqr,markersFsqr=[],iconMarkerFsqr,posMarkerFsqr={},initMap=function(){var e=!1;e=appView.chosenArea().areaId;var t=myJson,r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),o=14;r>400&&r<=1e3&&(o=13),r<=400&&(o=12);var a=[{featureType:"administrative.country",elementType:"geometry.fill",stylers:[{color:"#98b9c5"}]},{featureType:"administrative.province",elementType:"geometry.fill",stylers:[{color:"#98b9c5"}]},{featureType:"administrative.locality",elementType:"geometry.fill",stylers:[{color:"#98b9c5"}]},{featureType:"administrative.neighborhood",elementType:"geometry.fill",stylers:[{color:"#98b9c5"}]},{featureType:"administrative.land_parcel",elementType:"geometry.fill",stylers:[{color:"#98b9c5"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#9dbecb"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#96becd"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{color:"#fff7dc"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#fff7dc"}]},{featureType:"poi.business",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{color:"#fff7dc"}]},{featureType:"poi.medical",elementType:"geometry.fill",stylers:[{color:"#fff7dc"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#fff7dc"}]},{featureType:"poi.place_of_worship",elementType:"geometry.fill",stylers:[{color:"#ffc540"}]},{featureType:"poi.school",elementType:"geometry.fill",stylers:[{color:"#2d7488"}]},{featureType:"poi.sports_complex",elementType:"geometry.fill",stylers:[{color:"#9fdbea"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#7da4b3"},{saturation:"0"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#b5cfd9"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#fbffcb"}]},{featureType:"transit.line",elementType:"geometry.fill",stylers:[{color:"#c9dbff"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#beddff"}]},{featureType:"transit.station.bus",elementType:"geometry.fill",stylers:[{color:"#c0dff4"}]},{featureType:"transit.station.rail",elementType:"geometry.fill",stylers:[{color:"#00708b"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#79b7cd"}]}];map=new google.maps.Map(document.getElementById("map"),{center:centerOn,styles:a,zoom:o,mapTypeControl:!1});for(var i=0;i<t.length;i++){var n=new google.maps.InfoWindow({maxWidth:100}),s="img/pin.png";myMarker=new google.maps.Marker({position:t[i].loc,map:map,icon:s}),myMarkers.push(myMarker),i===e&&(myMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){myMarker.setAnimation(null)},2100)),i!==e&&appView.submitted()===!0&&myMarker.setMap(null),google.maps.event.addListener(myMarker,"click",function(e,r){return function(){e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2100);var o='<div class="infowindow"><h3 class = "infoWindowHeading">'+t[r].name+"</h3><p><br>Click on the map to show more information</p></div>";n.setContent(o),n.open(map,e),map.panTo(t[r].loc)}}(myMarker,i))}var l,p,c=[],m=new google.maps.InfoWindow({maxWidth:150});for(i=0;i<t.length;i++)e===!1?p=.4:e===i?p=.8:e!==i&&(p=.2),l=new google.maps.Polygon({paths:t[i].coords,strokeColor:"black",strokeOpacity:.8,strokeWeight:.5,fillColor:t[i].fill,fillOpacity:p,position:t[i].loc}),c.push(l),l.setMap(map),google.maps.event.addListener(l,"click",function(e,r){return function(){var o='<div><h3 class = "infoWindowHeading">'+t[r].name+"</h3><p><br>"+t[r].info+'<img src = "'+t[r].img+'"></p></div><div id="pano"></div>';m.setContent(o),m.open(map,e),map.panTo(t[r].loc)}}(l,i)),l.setMap(map);var f=[],y=[],d=[],u=[],h=document.getElementsByClassName("poiList");$.each(fsqrData,function(e,r){posMarkerFsqr.lat=r.lat,posMarkerFsqr.lng=r.lng,f.push(r.name),y.push(r.address),d.push(r.phone),u.push(r.url),iconMarkerFsqr=r.iconPre+"bg_32"+r.iconSuf,markerFsqr=new google.maps.Marker({position:posMarkerFsqr,map:map,icon:iconMarkerFsqr}),markerFsqr.addListener("click",function(){var r='<div class="infowindow"><h3 class = "infoWindowHeading">'+f[e]+"</h3><p> "+y[e][0]+"  <br> "+y[e][1]+"<br>"+y[e][2]+"<br>"+d[e]+'   <br><a title="This link will open in a new tab" href = " '+u[e]+'" target="_blank" >'+u[e]+"</a></p></div>";n.setContent(r),n.open(map,this),map.panTo(t[e].loc)}),markersFsqr.push(markerFsqr);var o=h[e];google.maps.event.addDomListener(o,"click",function(e,r){var o='<div class="infowindow"><h3 class = "infoWindowHeading">'+f[r]+"</h3><p> "+y[r][0]+"  <br> "+y[r][1]+"<br>"+y[r][2]+"<br>"+d[r]+'   <br><a title="This link will open in a new tab" href = " '+u[r]+'" target="_blank" >'+u[r]+"</a></p></div>";return function(){e.setAnimation(null),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},2100),n.setContent(o),n.open(map,e),map.panTo(t[r].loc)}}(markerFsqr,e))})};